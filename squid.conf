# === ACL Definitions ===

# ACL for whitelisted source IPs read from a file
# Using a local copy that is maintained by the entrypoint script
acl allowed_ips src "/tmp/whitelist.txt"

# Standard ACLs for security
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unprivileged ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

# === HTTP Access Rules (ORDER IS CRITICAL) ===
# 1. Deny requests for unsafe ports
http_access deny !Safe_ports

# 2. Deny CONNECT requests for non-SSL ports
http_access deny CONNECT !SSL_ports

# 3. Allow access for whitelisted IPs only
http_access allow allowed_ips

# 4. Finally, deny all other access
http_access deny all

# === Port and Other Settings ===
# Port to listen on
http_port 3128

# Where to save core dump files in case of a crash
coredump_dir /var/spool/squid

# === Refresh Patterns (Caching Rules) ===
# (Your refresh patterns are standard and can remain as they are)
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

